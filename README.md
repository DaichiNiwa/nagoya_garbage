# 名古屋市粗大ごみ回収システム nagoya_garbage
2020年3月制作  
自治体の粗大ごみ収集・管理ができるアプリケーションです。
市民が粗大ごみの回収を申請するところから、職員（管理者）が申請されたごみを管理、回収作業員がごみリストを見ながら回収していくところまで行うことができます。  
  
デモサイト  
https://nagoya-garbage.xyz/index.php  
設計書(GoogleDrive)  
https://docs.google.com/spreadsheets/d/1x8p0Jbtv2BLuiXahS9KGt7IAlRcI0jdwpz9-lW4oEfg/edit?usp=sharing
# 開発の目的
* 自治体による粗大ごみの回収がどんなシステムで行われているのか気になったので、自分で作ってみたくなった。また粗大ゴミの回収には市民、市役所職員、回収作業員の3者が関わっており、それぞれの立場で使いやすいシステムはどんなか考えながら作るのが楽しそうだと思った。
* この開発を通して自分のPHPのスキルを伸ばしたい、開発経験を増やしたいと思った。
* 転職活動の際、このアプリケーションを通して自分のPHPのスキルを知ってもらえるようにするため。
# 開発環境
* PHP 7.2  
* MySQL 5.7
* phpmyadmin
* Bootstrap 4.1.3
* Docker Desktop for Mac 19.03.5
* git version 2.23.0
* macOS Catalina 10.15.3
# 主な機能
## 市民向け
* ごみ回収の申請  
ごみの種類と自分の情報（氏名、住所など)を登録する。ごみの回収予定日が表示される。
## 管理者（市役所職員）向け
* 全てのごみの一覧表示  
ごみの情報（種類や回収ステータス)と申請者の情報（氏名、住所など)が1０件ずつ表示される。
* ごみの検索  
ごみを区ごとや回収ステータス（未回収や回収済など）ごとに検索する。申請者の氏名で検索することもできる。
* ごみの情報更新  
各ごみの回収ステータス（未回収や回収済など）や管理者コメントを更新する。ごみを一覧から削除する。
* 回収作業員の一覧表示、新規登録、情報更新  
回収作業員の情報（氏名、担当区など）を表示する。作業員を新規に登録、削除したり、担当区を変更したりできる。
* 管理者用ログインIDとパスワードの変更  
管理者用のログインIDとパスワードを変更できる。
## 回収作業員向け
* 担当区のごみ一覧表示  
作業員の担当区に合わせて、ごみと申請者の情報（回収ステータスや住所)が1０件ずつ表示される。
* 全てのごみの一覧表示  
全てのごみの情報が表示される。基本的には作業員は上記の担当区のごみ一覧を見ながら回収作業をすることを想定しているが、担当区以外のごみを回収することもあるかもしれないので、全てのごみ情報も見ることができる。
* ごみの情報更新  
管理者と同様に各ごみの回収ステータス（未回収や回収済など）や作業員コメントを更新できる。ただし管理者とは違い、ごみを削除することはできない。
# 工夫した点、こだわった点
## 1.読みやすいコード、意図が伝わりやすいコード
今回は転職活動にあたって私のPHPのスキルをアピールすることを目的として制作したため、初めてこのコードを見る人にも分かりやすい、制作者の意図が伝わりやすいコードを作ろうと努めました。  
そのために気をつけた点は以下の通りです。
* 分かりやすい関数名、変数名、ファイル名  
その関数が何を行うのか、何を返すのか、その変数には何が入っているのかが出来るだけ分かりやすいように命名しました。結果的に名前が長くなってしまってタイピング量が増えた面もありますが、意図の伝わりやすさを最重要視しました。
* 「1つの関数には1つの仕事」を意識する  
出来るだけ関数の機能を細分化して、1つ1つの関数の役割をはっきりさせ、メンテナンス性を向上させました。
* それぞれのファイルや関数の立ち位置を意識する  
私がお世話になったプログラミング講師の方の言葉で「部長には部長の仕事、課長には課長の仕事、平社員には平社員の仕事がある。それはプログラミングでも同じ」という言葉が印象に残っています。今回はMVCモデルで構成されていますが、それぞれのファイルの役割を意識して、「この処理は本当にこのファイルで行うのがいいのだろうか」と自問しながら制作しました。  
また関数についても細分化したため、1つの処理で何層もの関数を通って返り値が来ることがあります。その際もこの処理は部長クラスの関数にやらせるべきか、それとも平社員クラスの仕事なのか考えながら関数に役割を持たせました。
* 数字やURLの定数化を積極的に行う  
コード内で突然現れる数字、いわゆるマジックナンバーをなるべく減らすように、文字数制限などの数字は出来るだけ定数として定義するように心がけました。また頻繁に使うURLも定数としてメンテナンス性を向上させました。
* コメントをできるだけつける  
各コードが何をやっているのか分かりやすいよう、コメントを出来るだけ付けるようにしました。
## 2.ユーザの使いやすさを意識しながら機能を盛り込む
このアプリケーションは市民、市役所職員、回収作業員の3者が使用するので、それぞれの立場に立って、本当にこれを使うとしたらどんな機能が必要なんだろうと考えながら作成しました。    
具体的にはユーザの使いやすさを考慮して、以下のような機能を盛り込みました。
### 市民向けページ  
* 記入内容の確認画面で確定前に確認  
申請情報の記入から申請完了画面の間に、申請内容の確認画面を設けました。ごみの種類から住所、氏名、電話番号など記入することが多いので、出来るだけユーザが安心して使えるように記入内容を確認してから確定できるようにしました。
### 管理者（市役所職員）向けページ  
* いろんなごみの検索機能  
管理者は全てのごみを見たい時もあれば、ある区のごみだけ、またはピンポイントで1つのごみだけを探したい時もあるでしょう。そのため、区と回収ステータスを指定して検索、区だけ、回収ステータスだけを指定しての検索、申請者の氏名で検索ができるようにしました。これでごみが大量にあったとしても、目的のごみにすぐアクセスできます。
* ごみの一括削除と個別削除  
もし回収作業がスムーズに行っていれば、管理者は作業員が回収済のステータスにしたごみを一括削除ボタンで一括削除することができます。一方で一つ一つのごみがしっかり回収されたか確認してから、個別に削除することもできます。
* 回収を担当した作業員がわかる  
ごみの回収ステータスが作業員によって変更された場合、誰が担当したのが名前が表示されます。
### 回収作業員向けページ  
* 担当区のごみ一覧表示  
作業員は各自タブレットでこのアプリケーションを見ながらごみを回収していくことを想定しています。ログインしたらすぐに自分の担当区のごみが一覧表示されるので、スムーズに作業に入れます。
* 「回収済に変更」ボタンを押しやすく  
作業員はごみリストの未回収のごみを1つずつ回収していきますが、回収が済んだらすぐステータスを回収済に変更できるように、分かりやすいボタンを作って、ワンタッチでステータス変更できるようにしました。
### 各ページ共通  
* ごみのステータスが詳細に指定できる  
ごみの回収ステータスは５種類あり、未回収、回収済、回収前保留、回収後保留、回収不可です。基本的には未回収と回収済の2つが使われるのがほとんどだと想定しています。しかし実際の現場では粗大ごみでない物が申請されてしまうなど、いろんな問題が起きるはずです。それらに対応できるようステータスも柔軟に設定しました。作業員が回収に行く前に問題が確認された場合は回収前保留、現場に行ってから回収できないと判断したら回収不可、回収はしたものの解決しなけばならない問題が残っている場合は回収後保留を使うことができます。これらのステータスにより管理者のごみの管理が便利になります。  
* 柔軟なコメント機能  
各ごみには申請者、管理者、作業員の3者が自由にコメントを記入することができます。これにより、細かい要望や連絡事項を伝えやすくなっています。
# 課題点、実装したかった機能
今回、私のスキルレベルや時間的な制約により、実装したかったができなかった機能がいくつかあります。
* ごみの複数登録  
このアプリケーションでは一人の申請者が1つのごみしか申請できないようになっていますが、実際には同時に複数申し込みたいこともあると思います。実際、開発の構想段階では1人につき最大3点ごみを登録できるようにしようと考えていました。しかしごみを1つだけ出したい人もいれば、3つ出したい人もいるということで柔軟に対応できるシステムが求められるので、仕組みが複雑でコードの量も多くなってしまうということで時間的理由から断念しました。
* 申請完了メール送信機能
市民のごみ申込が完了したら、自動で確認のメールを送る機能を盛り込めたら良かったと思います。
* 住所の詳細な登録
住所を登録する際、名古屋市の13の区はセレクトボックスで選択式にしていますが、それ以下の住所はテキストボックスで自由入力になっています。本来は区以下の住所も分類した上で、選択式で選べると良かったと思います。
* 詳細な住所によりごみの表示順を決める
1つ上の機能と関連しますが、区以下の詳細な住所を分類することにより、住所ごとにごみを表示できたと思っています。現状では作業員が担当区のごみを回収する際に、区以下の住所に関係なく新着順にごみを表示しています。しかしこれではどんな順番で回収に回ったらよいかが一目で分かりません。詳細な住所に分類することによってごみを回収する順番にごみリストが表示されるようにできたら良かったなと思います。だたこれは実装するとなると、ごみの理想的な回収ルートをイメージしながら名古屋市内の膨大な量の住所を登録しなけらばならないのでなかなか大変だと思います。  
  
私が学習経験のあるPHPの基本的な機能で、実装してもよかったけどしなかった機能もいくつかありました。
* トランザクション  
このアプリケーションでは2つのテーブルを同時に更新する操作がなかったので使いませんでした。  
(今回はgarbagesという1つのテーブルにごみの情報と共に申請者の氏名や住所などの情報をまとめて登録していました。完全に1つのごみに一人のユーザという関係だったのでそうしましたが、本来ならユーザの情報は別テーブルに分けた方がよかったかもしれないと考えています。その場合はトランザクションを用いることになったと思います。)
* クッキー  
# CSSとレスポンシブについて
今回はPHPの学習を重視したのでサイトのデザインはかなりシンプルになっています。実際CSSはほぼ全てBootstrapのみでやって、自分ではCSSファイルを作っていません。  
Bootstrapを使用していることで簡易的にですがレスポンシブ対応しています。各ページは以下のようなデバイスで閲覧されることを想定しています。
* 市民向けページ  
スマホ、タブレット、PC
* 管理者向けページ  
PC
* 作業員向けページ  
タブレット
# 構想と設計
今回の開発では、まずざっくりとした構想をコンセプトシートとしてまとめることから始めました。次に実装する機能、テーブル設計、ファイル構成、定数などを設計書にまとめて、コーディングに入りました。  
コンセプトシート(GoogleDrive)  
※実際のアプリケーションとは異なる部分もあります。  
https://docs.google.com/document/d/1LOvDmlbQrLCuDCNumE9anuIEGNeB0J6BqbwIvGpqwLs/edit?usp=sharing  
設計書(GoogleDrive)  
https://docs.google.com/spreadsheets/d/1x8p0Jbtv2BLuiXahS9KGt7IAlRcI0jdwpz9-lW4oEfg/edit?usp=sharing
# 今後
今回の開発経験を踏まえて今後挑戦してみたいことは以下の通りです。
* composerで便利な外部ライブラリを使う  
今回はcomposerを使いませんでしたが、今後は便利な外部ライブラリを使って開発を楽にできるようにcomposerを使いたいと思います。
* 名前空間を適切に使う  
今回は一切名前空間を定義しなかったため、長すぎる関数名などが発生してしまいました。今後は適切に名前空間を用いて、より読みやすいコードを目指したいと思います。
* もう少し厳密な開発工程で行う  
今回は簡易的な構想と設計書でコーディングに入りましたが、次回からは要件定義や基本設計をもう少し厳密にやってみたいと思います。
* よりハイレベルなPHPの機能を実装する  
今回はPHPの入門レベルの機能の組み合わせだけでしたので、メールの自動送信などもっといろんな機能を学んで使いこなせるようにしたいです。
* フロントエンドの充実  
今回はかなりシンプルなデザインのサイトですが、今後はよりJavaScriptやjQueryへの理解を深めて、より使いやすいサイトを作りたいです。
# 最後に
長文をお読みいただき、誠にありがとうございました。今後もエンジニアとしてのスキルアップに励んでいきたいと思います。

